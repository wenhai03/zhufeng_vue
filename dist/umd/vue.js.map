{"version":3,"file":"vue.js","sources":["../../src/observe/array.js","../../src/util.js","../../src/observe/index.js","../../src/state.js","../../src/init.js","../../src/index.js"],"sourcesContent":["// 拿到数组原型上的方法 (原来的方法)\nlet oldArrayProtoMethods = Array.prototype\n\n// 继承一下\nexport let arrayProtoMethods = Object.create(oldArrayProtoMethods)\n\nlet methods = [\n  'push',\n  'pop',\n  'unshift',\n  'shift',\n  'reverse',\n  'splice',\n  'sort'\n]\n\nmethods.forEach(method => {\n  arrayProtoMethods[method] = function (...args) {\n    // this就是observe里的value\n    const result = oldArrayProtoMethods[method].call(this, args)\n    let inserted\n    let ob = this.__ob__\n    switch (method) {\n      case 'push':\n      case 'unshift': // 这两个方法都是追加 追加的内容可能是对象类型，应该再次进行劫持\n        inserted = args\n        break\n      case 'splice': // vue.$set原理\n        inserted = args.slice(2) // arr.splice(0, 1, {a: 1})\n      default:\n        break;\n    }\n    if (inserted) {\n      // 给数组新增的值也要进行观测\n      ob.observeArray(inserted)\n    }\n    \n    console.log('数组方法被调用了')\n    return result\n  }\n})\n","export function proxy (vm, data, key) {\n  Object.defineProperty(vm, key, {\n    get () {\n      return vm[data][key] // vm._data.a\n    },\n    set(newValue){\n      vm[data][key] = newValue\n    }\n  })\n}\n\nexport function defineProperty(target, key, value) {\n  Object.defineProperty(target, '__ob__', {\n    enumerable: false, // 不能被枚举，不能被循环出来\n    configurable: false,\n    value: value\n  })\n}\n","import {arrayProtoMethods} from \"./array\"\nimport {defineProperty} from \"../util\"\n\nclass Observer {\n  constructor (value) {\n    // 使用defineProperty重新定义属性\n    \n    // 判断一个对象是否被观测过看他有没有 __ob__这个属性\n    defineProperty(value, '__ob__', this)\n    \n    if (Array.isArray(value)) {\n      // 我希望调用push unshift splice reverse pop\n      // 函数劫持 切片编程\n      value.__proto__ = arrayProtoMethods\n      // 观测数组中的对象类型，对象变化也要做一些事\n      this.observeArray(value )\n    } else {\n      this.walk(value)\n    }\n  }\n  \n  observeArray (value) {\n    value.forEach(item => {\n      observe(item) // 观测数组中的对象类型\n    })\n  }\n  walk (data) {\n    let keys = Object.keys(data) // 获取对象的key\n  \n    keys.forEach(key  => {\n      defineReactive(data, key, data[key])\n    })\n  }\n\n}\n\n// 封装 继承\nfunction defineReactive (data, key, value) {\n  observe(value) // 如果是对象类型再进行观测(递归)\n  Object.defineProperty(data, key,{\n    get () {\n      console.log('用户获取值了')\n      return value\n    },\n    set (newValue) {\n      console.log('用户设置值了')\n      if (newValue === value) return\n      observe(newValue) // 如果用户将值改成对象继续监控\n      value = newValue\n    }\n  })\n}\n\nexport function observe(data){\n  // typeof null 也是 object\n  // 不能不是对象 并且不是null\n  if (typeof data !== 'object' || data == null) {\n    return\n  }\n  if (data.__ob__) {\n    return data\n  }\n  return new Observer(data)\n  \n}\n","import {observe} from \"./observe/index\"\nimport {proxy} from \"./util\"\n\nfunction initProps (vm) {\n\n}\n\nfunction initMethod (vm) {\n\n}\n\n\nfunction initData (vm) {\n  // 数据初始化工作\n  let data = vm.$options. data // 用户传递的data\n  vm._data = data = typeof data === 'function' ? data.call(vm) : data\n  // 对象劫持 用户改变了数据 我希望可以得到通知 => 刷新页面\n  // MVVM模式 数据变化可以驱动视图变化\n  // Object.defineProperty() 给属性增加get和set方法\n  \n  \n  // 当我去vm上取属性时，帮我将属性的取值代理到vm._data上\n  for (let key in data) {\n    proxy(vm, '_data', key)\n  }\n  observe(data) // 响应式原理\n  \n}\n\nfunction initWatch (vm) {\n\n}\n\nfunction initComputed (vm) {\n\n}\n\nexport function initState (vm) {\n  const opts = vm.$options\n  // vue的数据来源 属性 方法 数据 计算属性 watch\n  if (opts.props) {\n    initProps(vm)\n  }\n  if (opts.methods) {\n    initMethod(vm)\n  }\n  if (opts.data) {\n    initData(vm)\n  }\n  if (opts.computed) {\n    initComputed(vm)\n  }\n  if (opts.watch) {\n    initWatch(vm)\n  }\n}\n","import {initState} from './state'\n\n// 在原型上添加一个init方法\nexport function initMixin(Vue) {\n  // 初始化流程\n  Vue.prototype._init = function (options) {\n    \n    // 数据的劫持\n    const vm = this // vue中使用 this.$options 指代的就是用户传递的属性\n    vm.$options = options\n    \n    // 初始化状态\n    initState(vm) // 分割代码\n  }\n}\n","// Vue的核心代码 只是Vue的一个声明\nimport {initMixin} from './init'\n\nfunction Vue(options) {\n  // 进行Vue的初始化操作\n  this._init(options)\n}\n\n// 通过引入文件的方式 给Vue原型上添加方法\ninitMixin(Vue)\n\nexport default Vue\n"],"names":[],"mappings":"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"}